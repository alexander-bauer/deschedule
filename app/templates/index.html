{% extends "base.html" %}

{% block head %}
{{ super() }}
<title>Deschedule</title>
{% endblock %}

{% block scripts %}
{{ super() }}

<script type="text/javascript">
function make_calendar_button() {
  if(any_sections_selected()) {
    section_ids = []
    $('.section-selected').each(function(index, section) {
      section_ids.push($(this).attr('data-classcode') + '.' + $(this).attr('data-number'));
    });

    ical_btn = $('#to_ical');
    ical_btn.removeAttr('disabled');
    ical_btn.attr('href', url_api_schedule_events('umbc', 'SPRING2016', section_ids));
  } else {
    ical_btn.attr('disabled', 'disabled');
    ical_btn.attr('href', '');
  }
}

$(document).ready(function() {
  console.log('Loading class sections...');
  api_classes('umbc', 'SPRING2016', function(resp) {
    var items = [];
    $.each(resp['data'], function(key, val) {
      items.push('<li>' + style_section(val) + '</li>');
    });

    $('#sections').html(items.join(""));
    $('.section').click(function(event) {
      $(this).toggleClass('section-selected');
    });
    $('.section').click(make_calendar_button);
  });
});
$(document).ready(function() {
  $('#to_ical').click(function(event) {
    location.href = $(this).attr('href');
  });
});
</script>
{% endblock %}

{% block content %}
{{ super() }}
<div id="title" class="mui--text-center">
  <div class="mui--text-display3">Deschedule</div>
  <div class="mui--text-display1">Simplify your Academic Calendar</div>
</div>

<div id="description">
  Deschedule is a free web service that collects lists of University class
  schedules, and generates event calendars that can be imported into any other
  calendar application. To use it, you don't need to make an account or log in.
  Enter your school, the classes (and section numbers) that you are in, and import
  the resulting URL into your calendar app.
</div>

<div class="mui--text-center">
  <button id="to_ical" class="mui-btn mui-btn--raised" disabled>Make iCalendar</button>
</div>

<ul id="sections"></ul>

{% endblock %}
