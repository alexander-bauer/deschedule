{% extends "base.html" %}

{% block head %}
{{ super() }}
<title>Deschedule</title>
{% endblock %}

{% block content %}
{{ super() }}
<div id="title" class="center-align teal-text darken-4">
  <h2>Deschedule</h2>
  <h4>Simplify your Academic Calendar</h4>
</div>

<p class="flow-text">
  Deschedule is a free web service that collects lists of University class
  schedules, and generates event calendars that can be imported into any other
  calendar application. To use it, you don't need to make an account or log in.
  Enter your school, the classes (and section numbers) that you are in, and import
  the resulting URL into your calendar app.
</p>

<ul id="sections-selected"></ul>

<div id="control-box">
  <div class=>
    <input id="ical_link"
           type="text"
           readonly="readonly" placeholder="iCalendar link">
    </input>
  </div> <br/>

  <form id="context" class="row">
    <div name="school" class="input-field col s2">
      <select disabled>
        <option value="UMBC" selected>UMBC</option>
      </select>
    </div>
    <div name="semester" class="input-field col s2 offset-s1">
      <select disabled>
        <option value="SPRING2016" selected>SPRING2016</option>
      </select>
    </div>
    <div class="input-field col s6 offset-s1">
      <i class="material-icons prefix">search</i>
      <input id="search" type="text" placeholder="ENGL101" disabled>
      <label for="search">Search</label>
    </div>
  </form>
</div>


<div id="results">
  <div class="preloader-wrapper active">
    <div class="spinner-layer spinner-blue-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>

  <div id="sections-container">
    <ul id="sections"></ul>

    <ul>
      <li>
        <div id="addsection-card"
           href="#addsection-modal"
           class="card modal-trigger waves-effect hoverable teal lighten-2">
          <div class="card-content">
            <span class="card-title">
              Missing a Section?
              <i class="material-icons right">add</i>
            </span>
            <p>Please add it.</p>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<div id="addsection-modal" class="modal">
  <form id="addsection">
    <div class="modal-content">
      <div class="row">
        <div class="input-field col s4">
          <input id="addsection-class_code"
                 name="class_code"
                 type="text"
                 placeholder="ENGL101"
                 class="validate"
                 required
                 pattern="[A-Z]{3,4}[0-9]{3}">
          <label for="class_code">Class Code</label>
        </div>
        <div class="input-field col s4">
          <input id="addsection-number"
                 name="number"
                 type="number"
                 min="0"
                 class="validate">
          <label for="number">Section Number</label>
        </div>
        <div class="input-field col s4">
          <select>
            <option value="Lecture" selected>Lecture</option>
            <option value="Discussion">Discussion</option>
            <option value="Laboratory">Laboratory</option>
          </select>
          <label>Section Type</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s3">
          <input id="addsection-monday" name="monday" class="filled-in" type="checkbox">
          <label for="addsection-monday">Monday</label>
          <br>
          <input id="addsection-tuesday" name="tuesday" class="filled-in" type="checkbox">
          <label for="addsection-tuesday">Tuesday</label>
        </div>
        <div class="input-field col s3">
          <input id="addsection-wednesday" name="wednesday" class="filled-in" type="checkbox">
          <label for="addsection-wednesday">Wednesday</label>
          <br>
          <input id="addsection-thursday" name="thursday" class="filled-in" type="checkbox">
          <label for="addsection-thursday">Thursday</label>
        </div>
        <div class="input-field col s3">
          <input id="addsection-friday" name="friday" class="filled-in" type="checkbox">
          <label for="addsection-friday">Friday</label>
        </div>
        <div class="input-field col s3">
          <input id="addsection-saturday" name="saturday" class="filled-in" type="checkbox">
          <label for="addsection-saturday">Saturday</label>
          <br>
          <input id="addsection-sunday" name="sunday" class="filled-in" type="checkbox">
          <label for="addsection-sunday">Sunday</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s4">
          <input id="addsection-time"
                 name="time"
                 type="text"
                 placeholder="01:00 PM"
                 class="validate"
                 required
                 pattern="[012]?[0-9]:[0-9][0-9]( [aApP]\.?[mM]\.?)?">
          <label for="time">Time</label>
        </div>
        <div class="input-field col s4">
          <input id="addsection-length"
                 name="length"
                 type="number"
                 min="0"
                 value="75"
                 class="validate"
                 required>
          <label for="length">Minutes</label>
        </div>
        <div class="input-field col s4">
          <input id="addsection-room"
                 name="room"
                 type="text"
                 class="validate"
                 pattern="[A-Z]+[0-9]+">
          <label for="room">Room</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s6">
          <input id="addsection-instructor"
                 name="instructor"
                 type="text"
                 placeholder="Jane Doe"
                 class="validate">
          <label for="instructor">Instructor</label>
        </div>
        <div class="input-field col s6">
          <input id="addsection-email"
                 name="email"
                 type="email"
                 class="validate">
          <label for="email">Instructor Email</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="input-field left">
        <a href="#!"
           class="modal-action modal-close waves-effect red lighten-2 btn-flat">Cancel</a>
      </div>

      <div class="input-field right">
        <input id="submit"
               type="submit"
               class="modal-action waves-effect teal lighten-3 btn-flat">
        <label for="submit">Add Section</label>
      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript">

$(document).ready(function() {
  $('#addsection').submit(function(event) {
    $('#addsection').addClass('submitting');
    event.preventDefault();
    var $inputs = $('#addsection :input');
    var values = {}
    $inputs.each(function() {
      if($(this).attr('type') == 'checkbox') {
        values[this.name] = $(this).is(':checked');
      } else {
        values[this.name] = $(this).val();
      }
    });

    var url = '/api/' + get_school() + '/semester/' + get_semester() +
      '/class/' + values['class_code'] + '/' + values['number'];
    var data = {
      kind: values['kind'],
      time: values['time'],
      length: values['length'],
      instructor: values['instructor'],
      email: values['email'],
      room: values['room'],
      days: format_days(values['monday'], values['tuesday'], values['wednesday'],
                        values['thursday'], values['friday'],
                        values['saturday'], values['sunday'])
    }
    console.log('Submitting section: ', url, data);

    $.post(url, data, function(resp) {
      console.log('Section added successfully.');
      $('#addsection').removeClass('submitting');
      $('ul#sections').append(style_section(data));
    });
  });

});


$(document).ready(function() {
  $('ul.schools li a').click(function() {
    $('#school_dropdown_label').html($(this).html());
  });
});

$(document).ready(function() {
  fill_all_sections('umbc', 'spring2016', function(resp) {
    $('.section').click(function(event) {
      $(this).toggleClass('active');
    });
    $('.section').click(function() {
      section_ids = []
        $('.section.active').each(function(index, section) {
          section_ids.push($(this).attr('data-classcode') + '.' + $(this).attr('data-number'));
        });

      to_ical = $('#to_ical');
      ical_link = $('#ical_link');
      if(section_ids.length > 0) {
        to_ical.removeAttr('disabled');
        ical_link.removeAttr('disabled');
        ical_link.attr('value', window.location.href +
            construct_schedule_url('umbc', 'spring2016', section_ids));
      } else {
        to_ical.attr('disabled', 'disabled');
        ical_link.attr('disabled', 'disabled');
        ical_link.attr('value', '');
      }
    });
  });
});

$(document).ready(function() {
  $('#to_ical').click(function(event) {
    section_ids = []
      $('.active').each(function(index, section) {
        section_ids.push($(this).attr('data-classcode') + '.' + $(this).attr('data-number'));
      });

    location.href = construct_schedule_url('umbc', 'spring2016', section_ids);
  });
});

$(document).ready(function() {
  $('#ical_link').focus(function() {
    $(this).select();
  });
});

</script>
{% endblock %}

